\ProvidesPackage{mystyle}
\usepackage[a4paper, top=2cm, bottom=2cm, left=3cm, right=3cm]{geometry}

\usepackage{comment,ifthen}
\ifENG\newenvironment{blockENG}{\begin{english}}{\end{english}}
  \else\excludecomment{blockENG}\fi
\ifRUS\newenvironment{blockRUS}{\begin{russian}}{\end{russian}}
  \else\excludecomment{blockRUS}\fi
\ifENG\newcommand{\caseENG}[1]{\textenglish{#1}}
  \else\newcommand{\caseENG}[1]{}\fi
\ifRUS\newcommand{\caseRUS}[1]{\textrussian{#1}}
  \else\newcommand{\caseRUS}[1]{}\fi
\ifENG
  \ifRUS\newcommand{\caseENGRUS}[3]{\textenglish{#1}#2\textrussian{#3}}
    \else\newcommand{\caseENGRUS}[3]{\textenglish{#1}}\fi
\else
  \ifRUS\newcommand{\caseENGRUS}[3]{\textrussian{#3}}
    \else\newcommand{\caseENGRUS}[3]{#2}\fi\fi
\newcommand{\genTh}[3]{
  \ifENG
    \newtheorem{the#1ENG}[envENG]{#2}
    \newenvironment{#1ENG}[1][]{\begin{english}\begin{the#1ENG}[##1]}{\end{the#1ENG}\end{english}}
    \else\excludecomment{#1ENG}\fi
  \ifRUS
    \newtheorem{the#1RUS}[envRUS]{#3}
    \newenvironment{#1RUS}[1][]{\begin{russian}\begin{the#1RUS}[##1]}{\end{the#1RUS}\end{russian}}
    \else\excludecomment{#1RUS}\fi
}

\newcommand{\MarkTrans}[1]%
{\markboth{\MakeUppercase{\GetTranslation{#1}}}{\MakeUppercase{\GetTranslation{#1}}}}

\usepackage{amsmath,amssymb}
\usepackage{unicode-math}
\usepackage{fontspec}
\usepackage{polyglossia}
\usepackage{savesym}
\setmainfont{XITS}
\setmathfont{XITS Math}
\setmainlanguage{russian}
\setotherlanguage{english}
\newfontfamily\russianfont{XITS}
\newfontfamily\cyrillicfonttt{Ubuntu Mono}
\newfontfamily\latinfonttt{Ubuntu Mono}
\PolyglossiaSetup{russian}{indentfirst=true}

\usepackage{etoc}
\usepackage{tocbibind}
\etocsettocdepth{subsubsection}
\newcommand{\globalTOC}{
    \etocsetnexttocdepth{section}
    \tableofcontents
}
\newcommand{\localTOC}{
    \etocsettocstyle{\section*{\contentsname}}{}
    \localtableofcontents
}

\usepackage{etex}
\usepackage{amsthm,amscd}
\usepackage{setspace}
\usepackage{chngcntr}
\usepackage[tt]{titlepic}
\usepackage{enumerate,makecell}
\usepackage{makeidx,tabularx,dashbox}
\usepackage[usenames,dvipsnames]{xcolor}
\usepackage[bookmarks=true,xetex,colorlinks=true,linkcolor=MidnightBlue,citecolor=cyan,backref=true,pdftitle={Category Theory for Scientists - –¢–µ–æ—Ä–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π –¥–ª—è —É—á–µ–Ω—ã—Ö}]{hyperref}
\usepackage{graphicx,float}
\usepackage{multirow}
\graphicspath{{../figures/}}

\usepackage{color}
\usepackage[all,poly,color,matrix,arrow]{xy}
\makeindex

\usepackage[backref=true, totoc=chapter, split=chapter]{enotez}
\DeclareTranslation{russian}{enotez-title}{–ü—Ä–∏–º–µ—á–∞–Ω–∏—è –ø–µ—Ä–µ–≤–æ–¥—á–∏–∫–∞}
\DeclareTranslation{russian}{enotez-splitted-title}{<name> <ref>}
\DeclareTranslation{russian}{enotez-section}{–ö —Ä–∞–∑–¥–µ–ª—É}
\DeclareTranslation{russian}{enotez-chapter}{–ö –≥–ª–∞–≤–µ}
\renewcommand*\enotezwritemark[1]{\textsuperscript{(#1)}}
\DeclareInstance{enotez-list}{custom}{paragraph}%
{notes-sep=.5\baselineskip, format=\normalfont, number=\textsuperscript{(#1)}}

\usepackage[bottom]{footmisc}
\usepackage{perpage}
\renewcommand{\thefootnote}{[\roman{footnote}]}
\makeatletter
\MakePerPage{footnote}
\makeatother

\newcommand{\longnote}[2][4.9in]{\fcolorbox{black}{yellow}{\parbox{#1}{\color{black} #2}}}
\newcommand{\shortnote}[1]{\fcolorbox{black}{yellow}{\color{black} #1}}
%\newcommand{\start}[1]{\shortnote{Start here: #1.}}
\newcommand{\cfbox}[2]{
    \colorlet{currentcolor}{.}
    {\color{#1}
    \fbox{\color{currentcolor}#2}}
}

\def\tn{\textnormal}
\def\mf{\mathfrak}
\def\mc{\mathcal}
\newcommand{\qtE}[1]{\tn{‚Äú}#1\tn{‚Äù}}
\newcommand{\qtR}[1]{\tn{¬´}#1\tn{¬ª}}

%\newcommand{\ZZ}{‚Ñ§}%{{\mathbb Z}}
%\newcommand{\QQ}{‚Ñö}%{{\mathbb Q}}
%\newcommand{\RR}{‚Ñù}%{{\mathbb R}}
%\newcommand{\CC}{‚ÑÇ}%{{\mathbb C}}
%\newcommand{\PP}{‚Ñô}%{{\mathbb P}}
%\newcommand{\NN}{‚Ñï}%{{\mathbb N}}

\DeclareMathOperator{\Hom}{Hom}
\DeclareMathOperator{\Path}{Path}
\DeclareMathOperator{\Paths}{Paths}
\DeclareMathOperator{\List}{List}
\DeclareMathOperator{\Aut}{Aut}
\DeclareMathOperator{\im}{im}
\DeclareMathOperator{\Fun}{Fun}
\DeclareMathOperator{\Ob}{Ob}
\DeclareMathOperator{\Skel}{Skel}
\DeclareMathOperator{\Op}{Open}
\DeclareMathOperator{\PK}{PK}
\DeclareMathOperator{\FK}{FK}
\DeclareMathOperator{\SEL*}{SEL*}
\DeclareMathOperator{\Res}{Res}
\DeclareMathOperator{\colim}{colim}
\DeclareMathOperator{\hocolim}{hocolim}
\DeclareMathOperator{\id}{id}
\DeclareMathOperator{\ids}{ids}

\newcommand{\hsp}{\hspace{.3in}}
\newcommand{\hsps}[1]{{\hspace{2mm} #1\hspace{2mm}}}
\newcommand{\tin}[1]{\text{\tiny #1}}

    \DeclareFontFamily{U}{mathb}{\hyphenchar\font45}
    \DeclareFontShape{U}{mathb}{m}{n}{<-6> mathb5 <6-7> mathb6 <7-8> mathb7 <8-9> mathb8 <9-10> mathb9 <10-12> mathb10 <12-> mathb12}{}
    \DeclareSymbolFont{mathb}{U}{mathb}{m}{n}
    \DeclareMathSymbol{\mylefttorightarrow}{\mathrel}{mathb}{"FC}
    \DeclareMathSymbol{\myrighttoleftarrow}{\mathrel}{mathb}{"FD}
    \DeclareMathSymbol{\myuptodownarrow}{\mathrel}{mathb}{"FE}
    \DeclareMathSymbol{\mydowntouparrow}{\mathrel}{mathb}{"FF}

\newcommand{\boxtitle}[1]{\begin{center}#1\end{center}\vspace{-.1in}}
\newcommand{\xyright}[1]{\xymatrix{~\ar[r]#1&}}
\newcommand{\xydown}[1]{\xymatrix{~\ar[d]#1\\~}}
\newcommand{\xydoown}[1]{\xymatrix{~\ar[ddd]#1\\\parbox{0in}{~}\\\parbox{0in}{~}\\~}}
\newcommand{\ttto}{\equiv\!\!>}
\newcommand{\iso}{\cong}
\newcommand{\op}{^\tn{op}}
\newcommand{\loc}{\tn{loc}}
\newcommand{\plpl}{+\!\!+\hspace{1pt}}
\newcommand{\qeq}{\mathop{=}^?}
\newcommand{\del}{\partial\,}

\newcommand{\LMO}[1]{\stackrel{#1}{‚àô}}
\newcommand{\LMOX}[1]{‚àô^{#1}}
\newcommand{\LTO}[1]{\stackrel{\tn{\tt{#1}}}{‚àô}}
\newcommand{\LTOX}[1]{‚àô^{\tn{\tt{#1}}}}
\newcommand{\LA}[2]{\ar[#1]^-{\tn {#2}}}
\newcommand{\LAL}[2]{\ar[#1]_-{\tn {#2}}}
\newcommand{\obox}[3]{\stackrel{#1}{\fbox{\parbox{#2}{#3}}}}
\newcommand{\llabox}[2]{\obox{#1}{1.6in}{#2}}
\newcommand{\mebox}[2]{\obox{#1}{1in}{#2}}
\newcommand{\smbox}[2]{\stackrel{#1}{\fbox{#2}}}
\newcommand{\fakebox}[1]{\tn{$\ulcorner$#1$\urcorner$}}
\newcommand{\sq}[4]{\xymatrix{#1\ar[r]\ar[d]&#2\ar[d]\\#3\ar[r]&#4}}
\newcommand{\coloneqq}{\mathrel{\mathop:}=}
\newcommand{\namecat}[1]{\begin{center}$#1\coloneqq$\end{center}}

\def\ullimit{\ar@{}[rd]|(.3)*+{\lrcorner}}
\def\urlimit{\ar@{}[ld]|(.3)*+{\llcorner}}
\def\lllimit{\ar@{}[ru]|(.3)*+{\urcorner}}
\def\lrlimit{\ar@{}[lu]|(.3)*+{\ulcorner}}
\def\ulhlimit{\ar@{}[rd]|(.3)*+{\diamond}}
\def\urhlimit{\ar@{}[ld]|(.3)*+{\diamond}}
\def\llhlimit{\ar@{}[ru]|(.3)*+{\diamond}}
\def\lrhlimit{\ar@{}[lu]|(.3)*+{\diamond}}
\newcommand{\clabel}[1]{\ar@{}[rd]|(.5)*+{#1}}
\newcommand{\TriRight}[7]{\xymatrix{#1\ar[dr]_{#2}\ar[rr]^{#3}&&#4\ar[dl]^{#5}\\&#6\ar@{}[u] |{\Longrightarrow}\ar@{}[u]|>>>>{#7}}}
\newcommand{\TriLeft}[7]{\xymatrix{#1\ar[dr]_{#2}\ar[rr]^{#3}&&#4\ar[dl]^{#5}\\&#6\ar@{}[u] |{\Longleftarrow}\ar@{}[u]|>>>>{#7}}}
\newcommand{\TriIso}[7]{\xymatrix{#1\ar[dr]_{#2}\ar[rr]^{#3}&&#4\ar[dl]^{#5}\\&#6\ar@{}[u] |{\Longleftrightarrow}\ar@{}[u]|>>>>{#7}}}

\newcommand{\arr}[1]{\ar@<.5ex>[#1]\ar@<-.5ex>[#1]}
\newcommand{\arrr}[1]{\ar@<.7ex>[#1]\ar@<0ex>[#1]\ar@<-.7ex>[#1]}
\newcommand{\arrrr}[1]{\ar@<.9ex>[#1]\ar@<.3ex>[#1]\ar@<-.3ex>[#1]\ar@<-.9ex>[#1]}
\newcommand{\arrrrr}[1]{\ar@<1ex>[#1]\ar@<.5ex>[#1]\ar[#1]\ar@<-.5ex>[#1]\ar@<-1ex>[#1]}
\newcommand{\To}[1]{\xrightarrow{#1}}
\newcommand{\Too}[1]{\xrightarrow{\ \ #1\ \ }}
\newcommand{\From}[1]{\xleftarrow{#1}}
\newcommand{\Fromm}[1]{\xleftarrow{\ \ #1\ \ }}
\newcommand{\Adjoint}[4]{\xymatrix@1{#2 \ar@<.5ex>[r]^-{#1} & #3 \ar@<.5ex>[l]^-{#4}}}
\newcommand{\adjoint}[4]{\xymatrix{#1\colon #2\ar@<.5ex>[r]& #3\hspace{1pt}:\hspace{-2pt} #4\ar@<.5ex>[l]}}
\newcommand{\prodmap}[2]{‚ü® #1, #2 ‚ü©}
\newcommand{\pb}[3]{\prodmap{#1}{#2}_{#3}}
\newcommand{\coprodmap}[2]{{\left\{\parbox{.1in}{#1\\#2}\right.}}
\newcommand{\po}[3]{\coprodmap{#1}{#2}^{#3}}

\newcommand{\Top}{{\mathbf{Top}}}
\newcommand{\Cat}{{\mathbf{Cat}}}
\newcommand{\Oprd}{{\mathbf{Oprd}}}
\newcommand{\Str}{{\mathbf{Str}}}
\newcommand{\Mon}{{\mathbf{Mon}}}
\newcommand{\Grp}{{\mathbf{Grp}}}
\newcommand{\Grph}{{\mathbf{Grph}}}
\newcommand{\Type}{{\mathbf{Type}}}
\newcommand{\Supp}{{\mathbf{Supp}}}
\newcommand{\Dist}{{\mathbf{Dist}}}
\newcommand{\Vect}{{\mathbf{Vect}}}
\newcommand{\Kls}{{\mathbf{Kls}}}
\newcommand{\Prop}{{\mathbf{Prop}}}
\newcommand{\FLin}{{\mathbf{FLin}}}
\newcommand{\Set}{{\mathbf{Set}}}
\newcommand{\Sets}{{\mathbf{Sets}}}
\newcommand{\PrO}{{\mathbf{PrO}}}
\newcommand{\Star}{{\mathbf{Star}}}
\newcommand{\Cob}{{\mathbf{Cob}}}
\newcommand{\Qry}{{\mathbf{Qry}}}
\newcommand{\set}{{\text \textendash}{\mathbf{Set}}}
\newcommand{\sSet}{{\mathbf{sSet}}}
\newcommand{\sSets}{{\mathbf{sSets}}}
\newcommand{\Grpd}{{\mathbf{Grpd}}}
\newcommand{\Pre}{{\mathbf{Pre}}}
\newcommand{\Shv}{{\mathbf{Shv}}}
\newcommand{\Rings}{{\mathbf{Rings}}}
\newcommand{\bD}{{\mathbf{\Delta}}}
\newcommand{\dispInt}{\parbox{.1in}{$\int$}}
\newcommand{\bhline}{\Xhline{2\arrayrulewidth}}
\newcommand{\bbhline}{\Xhline{2.5\arrayrulewidth}}
\newcommand{\bbbhline}{\Xhline{3\arrayrulewidth}}


\newcommand{\undsc}{\rule{2mm}{0.4pt}}
\newcommand{\Loop}{{ùìõ\!oop}}
\newcommand{\LoopSchema}{{\parbox{.5in}{\fbox{\xymatrix{\LMOX{s}\ar@(l,u)[]^f}}}}}

%%%%%%%%%%%%%%%% ORIGINAL

\makeatletter\let\c@figure\c@equation\makeatother%Aligns figure numbering and equation numbering.

\newtheoremstyle{myth}% <name>
{1pt}% <Space above>
{1pt}% <Space below>
{\upshape}% <Body font>
{}% <Indent amount>
{\bfseries}% <Theorem head font>
{:}% <Punctuation after theorem head>
{.5em}% <Space after theorem head>
{}% <Theorem head spec (can be left empty, meaning `normal')>

\theoremstyle{myth}
\newtheorem{envENG}{Theorem}[chapter]
\newtheorem{envRUS}{–¢–µ–æ—Ä–µ–º–∞}[chapter]

\genTh{theorem}{Theorem}{–¢–µ–æ—Ä–µ–º–∞}
\genTh{definition}{Definition}{–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ}
\genTh{lemma}{Lemma}{–õ–µ–º–º–∞}
\genTh{proposition}{Proposition}{–£—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ}
\genTh{corollary}{Corollary}{–°–ª–µ–¥—Å—Ç–≤–∏–µ}
\genTh{fact}{Fact}{–§–∞–∫—Ç}
\genTh{remark}{Remark}{–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ}
\genTh{example}{Example}{–ü—Ä–∏–º–µ—Ä}
\genTh{warning}{Warning}{–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ}
\genTh{question}{Question}{–í–æ–ø—Ä–æ—Å}
\genTh{guess}{Guess}{–î–æ–≥–∞–¥–∫–∞}
\genTh{answer}{Answer}{–û—Ç–≤–µ—Ç}
\genTh{construction}{Construction}{–ö–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—è}
\genTh{rules}{Rules of good practice}{–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏}
\genTh{exc}{Exercise}{–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ}
\genTh{app}{Application}{–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ}
\genTh{notation}{Notation}{–û–±–æ–∑–Ω–∞—á–µ–Ω–∏–µ}
\genTh{conjecture}{Conjecture}{–ì–∏–ø–æ—Ç–µ–∑–∞}
\genTh{postulate}{Postulate}{–ü–æ—Å—Ç—É–ª–∞—Ç}

\ifENG\newenvironment{proofENG}{\begin{proof}[Proof]}{\end{proof}}\else\excludecomment{proofENG}\fi
\ifRUS\newenvironment{proofRUS}{\begin{proof}[–î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ]}{\end{proof}}\else\excludecomment{proofRUS}\fi

\ifENG\newenvironment{exerciseENG}{\begin{excENG}}{\hspace*{\fill}$\lozenge$\end{excENG}}\else\excludecomment{exerciseENG}\fi
\ifRUS\newenvironment{exerciseRUS}{\begin{excRUS}}{\hspace*{\fill}$\lozenge$\end{excRUS}}\else\excludecomment{exerciseRUS}\fi

\ifENG\newenvironment{applicationENG}{\begin{appENG}}{\hspace*{\fill}$\lozenge\lozenge$\end{appENG}}\else\excludecomment{applicationENG}\fi
\ifRUS\newenvironment{applicationRUS}{\begin{appRUS}}{\hspace*{\fill}$\lozenge\lozenge$\end{appRUS}}\else\excludecomment{applicationRUS}\fi

\ifENG\newenvironment{sloganENG}{\addtocounter{envENG}{1}\vspace{.1in}\begin{sloppypar}\noindent{\em Slogan}\;\arabic{envENG}: \begin{quote}{\bf ‚Äú}\slshape}{{\bf ‚Äù}\end{quote}\end{sloppypar}\vspace{.1in}}\else\excludecomment{sloganENG}\fi
\ifRUS\newenvironment{sloganRUS}{\addtocounter{envRUS}{1}\vspace{.1in}\begin{sloppypar}\noindent{\em –õ–æ–∑—É–Ω–≥}\;\arabic{envRUS}: \begin{quote}{\bf ¬´}\slshape}{{\bf ¬ª}\end{quote}\end{sloppypar}\vspace{.1in}}\else\excludecomment{sloganRUS}\fi

%%%%%%%%%%%%%%%%

\def\Finm{{\mathbf{Fin}_{m}}}
\def\Prb{{\mathbf{Prb}}}
\def\Prbs{{\wt{\mathbf{Prb}}}}
\def\El{{\mathbf{El}}}
\def\Gr{{\mathbf{Gr}}}
\def\DT{{\mathbf{DT}}}
\def\DB{{\mathbf{DB}}}
\def\Tables{{\mathbf{Tables}}}
\def\Sch{{\mathbf{Sch}}}
\def\Fin{{\mathbf{Fin}}}
\def\P{{\mathbf{P}}}
\def\SC{{\mathbf{SC}}}
\def\ND{{\mathbf{ND}}}
\def\Poset{{\mathbf{Poset}}}

\def\GrIn{{\mathbf{GrIn}}}
\def\GrInSchema{\xymatrix{\LMO{Ar}\ar@<.5ex>[r]^{src}\ar@<-.5ex>[r]_{tgt}&\LMO{V\!e}}}

\setcounter{secnumdepth}{3}

\def\sub{\begin{itemize}\item}
\def\endsub{\end{itemize}}
\def\sexc{\begin{enumerate}[a.)]\setlength{\itemsep}{.1cm}\setlength{\parskip}{.1cm}\item}
\def\endsexc{\end{enumerate}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\title{~\\\caseENGRUS{Category Theory for Scientists}{\\}{–¢–µ–æ—Ä–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π –¥–ª—è —É—á–µ–Ω—ã—Ö}}

\author{\caseENGRUS{David I. Spivak}{\\}{–î—ç–≤–∏–¥ –ò. –°–ø–∏–≤–∞–∫}}

\titlepic{
  \vspace{1.3in}
  \dashbox{\includegraphics[width=.8\textwidth]{ScientificMethod}}\\
  \vspace{.3in}\Large
  \caseENGRUS{
      How can mathematics make this diagram meaningful?
  }{\\}{
      –ö–∞–∫ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞ –º–æ–∂–µ—Ç –ø—Ä–∏–¥–∞—Ç—å —Å–º—ã—Å–ª —ç—Ç–æ–π –¥–∏–∞–≥—Ä–∞–º–º–µ?
  }\normalsize
}

%%%%%%%%%%%%%%%%%%%

\newcommand{\MainCatLarge}[1]{
  \stackrel{#1}{\parbox{4.5in}{
    \fbox{\parbox{4.4in}{
      \begin{center}
        \underline{{\tt Employee} manager worksIn $\simeq$ {\tt Employee} worksIn}\hsp  
        \underline{{\tt Department} secretary worksIn $\simeq$ {\tt Department}}
      \end{center}~
      \\\\\\
      \xymatrix@=8pt{
        &\LTO{Employee}\ar@<.5ex>[rrrrr]^{\tn{worksIn}}\ar@(l,u)[]+<5pt,10pt>^{\tn{manager}}\ar[dddl]_{\tn{first}}\ar[dddr]^{\tn{last}}&&&&&\LTO{Department}\ar@<.5ex>[lllll]^{\tn{secretary}}\ar[ddd]^{\tn{name}}
        \\\\\\
        \LTO{FirstNameString}&&\LTO{LastNameString}&~&~&~&\LTO{DepartmentNameString}
      }
    }}
  }}
}
